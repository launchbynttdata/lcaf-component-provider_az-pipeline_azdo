parameters:
  - name: serviceConnection
    type: string
  - name: storageAccountName
    type: string
  - name: timeInMinutes
    type: number
    default: 1


steps:
  - task: AzureCLI@2
    displayName: Delete Old Files
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: az storage blob delete-batch -s '$web' --account-name ${{ parameters.storageAccountName }} --if-unmodified-since $(date -u -d "${{ parameters.timeInMinutes }} minutes ago" +%Y-%m-%dT%H:%MZ)