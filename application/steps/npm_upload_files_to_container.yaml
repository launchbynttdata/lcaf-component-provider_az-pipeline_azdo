parameters:
  - name: serviceConnection
    type: string
  - name: storageAccountName
    type: string
  - name: srcFilePath
    type: string   
  - name: timeInMinutes
    type: number
    default: 1     


steps:
  - task: AzureCLI@2
    displayName: Upload files to container
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      scriptType: 'bash'
      scriptLocation: inlineScript
      inlineScript: |
        az storage blob upload-batch --destination '$web' --account-name ${{ parameters.storageAccountName }} --source ${{ parameters.srcFilePath }} --if-unmodified-since $(date -u -d "${{ parameters.timeInMinutes }} minutes ago" +%Y-%m-%dT%H:%MZ)