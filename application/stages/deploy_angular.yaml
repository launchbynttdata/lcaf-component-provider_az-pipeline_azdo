parameters:    
  - name: deployEnvironments
    type: object
  - name: repoCheckoutSteps
    type: stepList
    default: []

stages:
  - ${{ each deployEnv in parameters.deployEnvironments }}:
    - stage: ${{ deployEnv.environment}}_PreDeploy
      displayName: '${{ deployEnv.environment }} - Pre deploy'
      dependsOn: ${{ deployEnv.dependsOn }}
      jobs:
        - template: ../jobs/deploy.yaml
          parameters:
            agentPool: ${{ deployEnv.agentPool }}
            serviceConnection: ${{ deployEnv.serviceConnection }}
            repoCheckoutSteps: ${{ parameters.repoCheckoutSteps }}
            artifactFeedName: ${{ deployEnv.artifactFeedName }}
            buildPackageName: ${{ deployEnv.buildPackageName }}
            packageVersion: ${{ deployEnv.packageVersion }}
            downloadDirectory: ${{ deployEnv.downloadDirectory }}
            srcAppConfigJsonPath: ${{ deployEnv.srcAppConfigJsonPath }}
            destAppConfigJsonDirPath: ${{ deployEnv.destAppConfigJsonDirPath }}
            storageAccountName: ${{ deployEnv.storageAccountName }}
            srcFilePath: ${{ deployEnv.srcFilePath }}
            timeInMinutes: ${{ deployEnv.timeInMinutes }}
            deploymentEnv: ${{ deployEnv.environment }}
